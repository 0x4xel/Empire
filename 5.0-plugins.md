5.0 Plugins
----

**These docs are for Empire 5.0 while its in development and will move to the empire-docs repo when its ready**

Not a lot has changed for plugins in Empire 5.0. We've just added a few guard rails for better
stability between Empire versions.

The plugin interface is a guarantee that certain functionality will not be changed outside of major
Empire version updates (ie 4->5). So which functions are guaranteed? Any of the functions on the
`core/*_service` classes not prefixed with a `_`.

Does this mean you can't use util functions or modify state in other parts of the empire code?
No. In most cases you will be fine to do so. We as maintainers just can't keep track of any and
every thing a plugin may be doing and guarantee that it won't break in a minor/patch update.
This is no different than the way things were pre 5.0.

# Using the database
If objects are being retrieved from the database, the service functions require a database session be passed in.
Effectively, this means that you must handle your database session in the plugin. Using the Context Manager syntax
ensures the db session gets cleaned up when done.
```python
from empire.server.database.base import SessionLocal

with SessionLocal() as db:
  agents = self.main_menu.agent_service.get_all(db)
  ...
```

## Event-based functionality (hooks and filters)
This is outlined in the Hooks and Filters page in the wiki.

## Future Work
* improved plugin logging -
  This will either come with 5.0 or in a minor update. Plugins currently still use print statements, while
  the rest of the codebase has been updated to use logging.
* plugin tasks -
  This idea hasn't been fully thought out, but it would be nice to be able to have plugin tasks
  where a user might want to come back to see the output at a later time. For this we could have
  tasks that work in a similar way to agent tasks.
* endpoint for installing plugins -
  A user would be able to provide the URL to a git repository and Empire would download and install the plugin.
